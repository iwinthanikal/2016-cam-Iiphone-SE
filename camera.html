<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SE Camera (2016 Edition)</title>
    <style>
        /* Modern Clean UI */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #000;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
        }

        h1 { font-weight: 300; font-size: 1.2rem; letter-spacing: 1px; color: #ccc; margin-bottom: 20px;}

        /* The Viewport */
        #canvas-container {
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            max-width: 90vw;
            max-height: 70vh;
            border: 1px solid #333;
        }

        canvas {
            display: block;
            max-width: 100%;
            height: auto;
        }

        /* Controls */
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
        }

        .btn {
            background: #fff;
            color: #000;
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.1s;
        }

        .btn:active { transform: scale(0.95); }
        
        .btn-upload { background: #333; color: #fff; border: 1px solid #555; }

        input[type="file"] { display: none; }

        /* Loading Spinner */
        #loading { display: none; margin-top: 10px; font-size: 0.9rem; color: #888; }
    </style>
</head>
<body>

    <h1>IPHONE SE 2016 FILTER</h1>

    <div id="canvas-container">
        <canvas id="photoCanvas"></canvas>
    </div>

    <div id="loading">Processing A9 ISP...</div>

    <div class="controls">
        <button class="btn btn-upload" onclick="document.getElementById('fileInput').click()">ðŸ“· Upload / Take</button>
        <button class="btn" id="downloadBtn" onclick="downloadImage()">Save Photo</button>
    </div>

    <input type="file" id="fileInput" accept="image/*" capture="environment">

    <script>
        const canvas = document.getElementById('photoCanvas');
        const ctx = canvas.getContext('2d');
        const fileInput = document.getElementById('fileInput');
        const loading = document.getElementById('loading');

        // Initial setup
        canvas.width = 640;
        canvas.height = 480;
        ctx.fillStyle = "#111";
        ctx.fillRect(0,0, canvas.width, canvas.height);
        ctx.fillStyle = "#555";
        ctx.font = "20px sans-serif";
        ctx.textAlign = "center";
        ctx.fillText("Upload a photo to start", canvas.width/2, canvas.height/2);

        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            loading.style.display = 'block';
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    // Resize to match screen but keep resolution decent (SE was 12MP, but for web we limit to 2000px width for speed)
                    let scale = 1;
                    if(img.width > 2000) scale = 2000 / img.width;
                    
                    canvas.width = img.width * scale;
                    canvas.height = img.height * scale;

                    // 1. Draw original image
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                    // 2. Apply The "SE 2016" Look
                    applyOldiPhoneFilter();
                    
                    loading.style.display = 'none';
                }
                img.src = event.target.result;
            }
            reader.readAsDataURL(file);
        });

        function applyOldiPhoneFilter() {
            const width = canvas.width;
            const height = canvas.height;
            
            // Get pixel data
            const imageData = ctx.getImageData(0, 0, width, height);
            const data = imageData.data;

            // NOISE FACTOR: Old sensors had more grain
            // iPhone SE 2016 Noise level: moderate (around 15-20 intensity)
            
            for (let i = 0; i < data.length; i += 4) {
                // Get RGB
                let r = data[i];
                let g = data[i+1];
                let b = data[i+2];

                // --- 1. COLOR SCIENCE ---
                // The SE 2016 (A9 chip) had punchy contrast but slightly cooler tones than modern warm iPhones.
                // We boost contrast and slightly desaturate to kill that "AI HDR" look.
                
                // Contrast boost formula
                const contrast = 1.15; // +15% contrast
                const intercept = 128 * (1 - contrast);
                
                r = r * contrast + intercept;
                g = g * contrast + intercept;
                b = b * contrast + intercept;

                // Saturation adjustment (Slight drop to mimic older digital sensor flatness)
                const gray = 0.2989 * r + 0.5870 * g + 0.1140 * b;
                const sat = 1.05; // Actually, Apple liked saturation, so we keep it 105%
                
                r = -gray * (1 - sat) + r * sat;
                g = -gray * (1 - sat) + g * sat;
                b = -gray * (1 - sat) + b * sat;

                // --- 2. DIGITAL NOISE (The Secret Sauce) ---
                // Add random variation to simulating ISO noise
                // The darker the pixel, the more visible the noise (sensor struggle)
                const noise = (Math.random() - 0.5) * 25; 
                
                r = r + noise;
                g = g + noise;
                b = b + noise;

                // --- 3. COOLER WHITE BALANCE ---
                // Modern phones are very warm. 2016 phones were slightly bluer/greener.
                b = b * 1.02; // Tiny blue tint
                r = r * 0.98; // Tiny red reduction

                // Clamp values 0-255
                data[i] = Math.min(255, Math.max(0, r));
                data[i+1] = Math.min(255, Math.max(0, g));
                data[i+2] = Math.min(255, Math.max(0, b));
            }

            ctx.putImageData(imageData, 0, 0);

            // --- 4. VIGNETTE (Optional but realistic for small lenses) ---
            // Draw a radial gradient overlay
            ctx.globalCompositeOperation = 'multiply';
            const gradient = ctx.createRadialGradient(width/2, height/2, width/3, width/2, height/2, width);
            gradient.addColorStop(0, "rgba(255,255,255,1)");
            gradient.addColorStop(1, "rgba(200,200,200,1)"); // Subtle darkening at edges
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);
            
            // Reset composition
            ctx.globalCompositeOperation = 'source-over';
        }

        function downloadImage() {
            const link = document.createElement('a');
            link.download = 'iphone_se_2016_photo.jpg';
            link.href = canvas.toDataURL('image/jpeg', 0.9);
            link.click();
        }
    </script>
</body>
</html>