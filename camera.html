<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Camera</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: #000;
            color: #fece00; /* Apple Yellow for active states */
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; /* Apple imitation font */
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            user-select: none;
        }

        /* --- TOP BAR (Flash, HDR, Timer) --- */
        .top-toolbar {
            height: 60px;
            background: #000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            z-index: 10;
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .icon-btn svg {
            fill: white;
            height: 22px;
            width: 22px;
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.5));
        }

        .hdr-badge {
            font-weight: 600;
            font-size: 13px;
            color: white; /* Default off */
            letter-spacing: 0.5px;
        }
        
        .hdr-on { color: #fece00; } /* Yellow when on */

        /* --- VIEWFINDER (Middle) --- */
        #viewport {
            flex-grow: 1;
            position: relative;
            background: #111;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        video, canvas {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Mimic fullscreen viewfinder */
        }

        canvas { display: none; }

        /* Focus Square Animation */
        #focus-box {
            position: absolute;
            width: 60px;
            height: 60px;
            border: 1px solid #fece00;
            box-shadow: 0 0 4px rgba(0,0,0,0.3);
            display: none;
            pointer-events: none;
            animation: focusAnim 0.4s ease-out forwards;
        }

        @keyframes focusAnim {
            0% { transform: scale(1.5); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* --- BOTTOM CONTROLS --- */
        .bottom-controls {
            height: 140px;
            background: rgba(0,0,0,0.4); /* Slight transparency */
            backdrop-filter: blur(10px); /* The "Frosted Glass" Apple look */
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding-bottom: 20px;
            position: relative;
        }

        /* Thumbnail (Gallery) */
        .gallery-preview {
            width: 44px;
            height: 44px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
            opacity: 0.8;
        }

        /* The Classic Shutter Button */
        #shutter-btn {
            width: 72px;
            height: 72px;
            background-color: white;
            border-radius: 50%;
            border: 4px solid rgba(0,0,0,0.1); /* Inner shadow ring */
            box-shadow: 0 0 0 4px white, 0 0 0 6px #000; /* Outer rings */
            cursor: pointer;
            transition: transform 0.1s;
        }
        #shutter-btn:active { background: #ccc; transform: scale(0.95); }

        /* Flip Camera */
        .flip-btn svg { width: 28px; height: 28px; }

        /* Mode Selector (PHOTO / SQUARE / VIDEO) */
        .mode-selector {
            position: absolute;
            top: -30px;
            width: 100%;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
            letter-spacing: 1px;
            color: #fece00;
            text-shadow: 0 1px 3px rgba(0,0,0,0.8);
        }

        /* Flash Effect */
        #flash-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: white; opacity: 0; pointer-events: none;
            transition: opacity 0.15s;
            z-index: 99;
        }

        /* Save Message */
        #save-msg {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            display: none;
            z-index: 50;
        }
    </style>
</head>
<body>

    <div class="top-toolbar">
        <button class="icon-btn">
            <svg viewBox="0 0 24 24"><path d="M7 2v11h3v9l7-12h-4l4-8z"/></svg>
        </button>
        <div class="hdr-badge" id="hdr-toggle">HDR</div>
        <button class="icon-btn">
            <svg viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="5" stroke="white" stroke-width="1.5" fill="none"/>
                <circle cx="12" cy="12" r="9" stroke="white" stroke-width="1.5" fill="none" stroke-dasharray="2 4"/>
            </svg>
        </button>
    </div>

    <div id="viewport" onclick="triggerFocus(event)">
        <video id="video" autoplay playsinline muted></video>
        <canvas id="canvas"></canvas>
        <div id="focus-box"></div>
        <div id="save-msg">Saved to Downloads</div>
    </div>

    <div id="flash-overlay"></div>

    <div class="bottom-controls">
        <div class="mode-selector">PHOTO</div>
        
        <div class="gallery-preview"></div> <button id="shutter-btn"></button>
        
        <button class="icon-btn flip-btn" id="flip-camera">
            <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 10c0-4.4-3.6-8-8-8s-8 3.6-8 8 0 8 8 8h8"/>
                <path d="M4 14l4-4-4-4"/>
                <path d="M20 6l-4 4 4 4"/>
            </svg>
        </button>
    </div>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const shutterBtn = document.getElementById('shutter-btn');
        const flashOverlay = document.getElementById('flash-overlay');
        const saveMsg = document.getElementById('save-msg');
        const focusBox = document.getElementById('focus-box');
        
        let currentFacingMode = 'environment'; // Start with back camera

        // 1. INIT CAMERA
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: currentFacingMode,
                        width: { ideal: 1920 },
                        height: { ideal: 1080 }
                    } 
                });
                video.srcObject = stream;
            } catch (err) {
                console.error("Camera Error:", err);
            }
        }
        startCamera();

        // 2. FOCUS ANIMATION (Visual Only)
        function triggerFocus(e) {
            const rect = document.getElementById('viewport').getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            focusBox.style.left = (x - 30) + 'px';
            focusBox.style.top = (y - 30) + 'px';
            focusBox.style.display = 'none';
            setTimeout(() => focusBox.style.display = 'block', 10);
            setTimeout(() => focusBox.style.display = 'none', 1000);
        }

        // 3. SHUTTER & PROCESSING
        shutterBtn.addEventListener('click', () => {
            // A. Flash Effect
            flashOverlay.style.opacity = 1;
            setTimeout(() => flashOverlay.style.opacity = 0, 150);

            // B. Capture
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);

            // C. Apply "iPhone 2016" Look
            applyVintageFilter();

            // D. Auto Save
            const link = document.createElement('a');
            link.download = `IMG_${Math.floor(Math.random()*9000)+1000}.jpg`;
            link.href = canvas.toDataURL('image/jpeg', 0.9);
            link.click();

            // E. Show Confirmation
            saveMsg.style.display = 'block';
            setTimeout(() => saveMsg.style.display = 'none', 2000);
        });

        // 4. FILTER LOGIC (Improved for authenticity)
        function applyVintageFilter() {
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            for(let i = 0; i < data.length; i += 4) {
                let r = data[i], g = data[i+1], b = data[i+2];

                // 1. "Tone Curve" - Crush shadows slightly
                // iPhone SE had good contrast. We verify values < 50 get darker.
                r = r < 50 ? r * 0.9 : r * 1.05;
                g = g < 50 ? g * 0.9 : g * 1.05;
                b = b < 50 ? b * 0.9 : b * 1.05;

                // 2. Cool Tint (The "Blue" Apple Look of 2016)
                // Boost Blue slightly, Reduce Red slightly
                b = b * 1.03;
                r = r * 0.98;

                // 3. Digital Grain (Subtle)
                const noise = (Math.random() - 0.5) * 12;
                r += noise; g += noise; b += noise;

                data[i] = Math.min(255, Math.max(0, r));
                data[i+1] = Math.min(255, Math.max(0, g));
                data[i+2] = Math.min(255, Math.max(0, b));
            }
            ctx.putImageData(imageData, 0, 0);
        }

        // 5. FLIP CAMERA BUTTON
        document.getElementById('flip-camera').addEventListener('click', () => {
            currentFacingMode = (currentFacingMode === 'environment') ? 'user' : 'environment';
            startCamera();
        });

    </script>
</body>
</html>
